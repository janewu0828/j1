<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>jQuery Mobile 網路應用程式</title>
<link href="jquery-mobile/jquery.mobile.theme-1.0.min.css" rel="stylesheet" type="text/css"/>
<link href="jquery-mobile/jquery.mobile.structure-1.0.min.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.0.min.js" type="text/javascript"></script>

<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" charset="utf-8">
	// alert dialog dismissed
    function alertDismissed() {
    }

    // Show a custom alertDismissed
    function showAlert() {
        navigator.notification.alert(
            'You are the winner!',  // message
            //alertDismissed,         // callback
            'Game Over',            // title
            'Done'                  // buttonName
        );
    }
</script>

<style>
#p21_div{}
html, body { width: 100%; height: 100%; margin: 0px; }
</style>

<script language="javascript">
	
	var Data=function(title, description, content){
		this.title=title;
		this.description=description;
		this.content=content;
		
		this.getTitle=function(){return this.title;}
		this.getDescript=function(){return this.description;}
		this.getContent=function(){return this.content;}
	}
	
	var arr1=new Array();	
	
	$(function(){
		$("#p21_div").width(window.innerWidth-40);
		$("#p21_div").height(window.innerHeight);
		$("#page21").bind("pageshow", showP21);
	});
	
	function showP21(){
		$("#p21_div").empty();		
		var p21_div=document.getElementById("p21_div");
		var p21_id=arr1[getQueryString("id")];
    	var c1=p21_id.getContent();
		$("#p21_div").append(c1) ;	
	}
	
	function init(){
		$.ajax({
			url: "http://womany.net/api/win8/hot_articles",
			type: "GET",
			dataType: "json",
			
			success: function(Jdata) {
				var list=$("#p2_dataList");		  
				list.empty(); 
				for(var i=0; i<Jdata.length; i++){					
					//list.append('<li><h3>' + Jdata[i].title + "</h3><p>" + Jdata[i].description + "</p></li>");
					var d=new Data(Jdata[i].title, Jdata[i].description, Jdata[i].content); 
                	arr1.push(d);
					list.append('<li><a href="#"><h3>' + arr1[i].title + 
                            "</h3><p>" + arr1[i].description +
                            "</p> </a> <a href='#page21&id=" + i + "'>詳細 </a></li>");
				}		  
				list.listview("refresh");			
			},
	
			error: function() {
				alert("ERROR1!!!");
			}
		});
	}
	
	function getQueryString(paramName){ 
	　　paramName = paramName .replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]").toLowerCase();
	　　var reg = "[\\?&]"+paramName +"=([^&#]*)"; 
	　　var regex = new RegExp( reg ); 
	　　var regResults = regex.exec( window.location.href.toLowerCase() ); 
	　　if( regResults == null )    return ""; 
	　　else    return regResults [1];
	}
</script>

</head> 
<body onLoad="init()"> 

<div data-role="page" id="page" >
	<div data-role="header">
		<h1>第一頁</h1>
        
		<button onclick="login()">Login</button>
		<button onclick="me()">Me</button>
		<button onclick="getLoginStatus()">Get login</button>
		<button onclick="logout()">Logout</button>
		<button onclick="facebookWallPost()">facebookWallPost</button>
		<button onclick="publishStoryFriend()">friendstory</button>
        
	</div>
	<div data-role="content">    
    	<ul data-role="listview">
			<li><a href="#page2">第二頁</a></li>
            <li><a href="#page3">第三頁</a></li>
			<li><a href="#page4">第四頁</a></li>
            
            <div id="data">loading ...</div>
            		 
		</ul>		
	</div>
	<div data-role="footer">
		<h4>頁尾</h4>
	</div>
</div>

<div data-role="page" id="page2" data-add-back-btn="true">
	<div data-role="header">
		<h1>第二頁</h1>
    </div>
	<div data-role="content">	
		<ul data-role="listview" id="p2_dataList">
            <li>
            	<a href="#">
                    <h3>頁面二</h3>
                    <p>Lorem ipsum</p>
      			</a>
                <a href="#page21">第二頁詳細</a>
            </li>
		</ul>
	</div>
	<div data-role="footer">
		<h4>頁尾</h4>
	</div>
</div>

<div data-role="page" id="page21" data-add-back-btn="true">
	<div data-role="header">
		<h1>第二頁之一</h1>
	</div>
	<div data-role="content">
    
    	<div id="p21_div"></div> 
        
	</div>
	<div data-role="footer">
		<h4>頁尾</h4>
	</div>
</div>

<div data-role="page" id="page3" data-add-back-btn="true">
	<div data-role="header">
		<h1>第三頁</h1>
	</div>
	<div data-role="content">	
		內容
        <p><a href="#" onclick="showAlert(); return false;">Show Alert</a></p>
	</div>
	<div data-role="footer">
		<h4>頁尾</h4>
	</div>
</div>

<div data-role="page" id="page4">
	<div data-role="header">
    <a href="#page" data-icon="back">Cancel</a>
		<h1>第四頁</h1>
	</div>
	<div data-role="content">	
		內容
	</div>
	<div data-role="footer">
		<h4>頁尾</h4>
	</div>
</div>  

        <!--<script src="http://localhost:8080/target/target-script-min.js#anonymous"></script>-->
        <div id="fb-root"></div>
        <!-- cordova -->
		<script src="cordova.js"></script>
	    <!-- cordova facebook plugin -->
		<script src="cdv-plugin-fb-connect.js"></script>
	    <!-- facebook js sdk -->
		<script src="facebook-js-sdk.js"></script>
        
		<script>
             <!-- These are the notifications that are displayed to the user through pop-ups if the above JS files does not exist in the same directory-->
            if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
            if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
            if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');
            
            FB.Event.subscribe('auth.login', function(response) {
                               alert('auth.login event');
                               });
            
            FB.Event.subscribe('auth.logout', function(response) {
                               alert('auth.logout event');
                               });
            
            FB.Event.subscribe('auth.sessionChange', function(response) {
                               alert('auth.sessionChange event');
                               });
            
            FB.Event.subscribe('auth.statusChange', function(response) {
                               alert('auth.statusChange event');
                               });
            
            /*function getSession() {
                alert("session: " + JSON.stringify(FB.getSession()));
            }
            */
            function getLoginStatus() {
              FB.getLoginStatus(function(response) {
                if (response.status == 'connected') {
                  alert('logged in');
                } else {
                  alert('not logged in');
                }
              });
            }
            var friendIDs = [];
			       var fdata;
            function me() {
                FB.api('/me/friends', { fields: 'id, name, picture' },  function(response) {
                       if (response.error) {
                       alert(JSON.stringify(response.error));
                       } else {
                       var data = document.getElementById('data');
					   fdata=response.data;
					   console.log("fdata: "+fdata);
                       response.data.forEach(function(item) {
                                             var d = document.createElement('div');
                                             d.innerHTML = "<img src="+item.picture+"/>"+item.name;
                                             data.appendChild(d);
                                             });
                       }
					var friends = response.data;
					console.log(friends.length); 
					for (var k = 0; k < friends.length && k < 200; k++) {
				        var friend = friends[k];
				        var index = 1;

				        friendIDs[k] = friend.id;
				        //friendsInfo[k] = friend;
					}
					console.log("friendId's: "+friendIDs);
                       });
            }
            
            function logout() {
                FB.logout(function(response) {
                          alert('logged out');
                          });
            }
            
            function login() {
              alert('a');
                FB.login(
                 function(response) {
                   alert('b+'+response.authResponse);
                   if (response.authResponse) {
                     alert('logged in');
                   } else {
                     alert('c');
                     alert('not logged in');
                   }
                 },
                 { scope: "email" }
                 );
            }
			
			
			function facebookWallPost() {
			    console.log('Debug 1');
				var params = {
				    method: 'feed',
				    name: 'Facebook Dialogs',
				    link: 'https://developers.facebook.com/docs/reference/dialogs/',
				    picture: 'http://fbrell.com/f8.jpg',
				    caption: 'Reference Documentation',
				    description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
				  };
				console.log(params);
			    FB.ui(params, function(obj) { console.log(obj);});
			}
            
			function publishStoryFriend() {
				randNum = Math.floor ( Math.random() * friendIDs.length ); 

				var friendID = friendIDs[randNum];
				if (friendID == undefined){
					alert('please click the me button to get a list of friends first');
				}else{
			    	console.log("friend id: " + friendID );
			        console.log('Opening a dialog for friendID: ', friendID);
			        var params = {
			        	method: 'feed',
			            to: friendID.toString(),
			            name: 'Facebook Dialogs',
			            link: 'https://developers.facebook.com/docs/reference/dialogs/',
			            picture: 'http://fbrell.com/f8.jpg',
			            caption: 'Reference Documentation',
			            description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
			     	};
					FB.ui(params, function(obj) { console.log(obj);});
			    }
			}
            
            document.addEventListener('deviceready', function() {
                                      try {
                                      alert('Device is ready! Make sure you set your app_id below this alert.');
									  //Put your FB APP_ID here!
                                      FB.init({ appId: "149909718537834", nativeInterface: CDV.FB, useCachedDialogs: false });
                                      document.getElementById('data').innerHTML = "";
                                      } catch (e) {
                                        alert('error');
                                      alert(e);
                                      }
                                      }, false);
            </script>
        <div id="log"></div>

</body>
</html>